<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Chat Privado - Sin Nombre</title>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<style>
body {
  margin: 0;
  font-family: Arial;
  background: linear-gradient(120deg, #1e3c72, #2a5298);
  color: white;
  height: 100vh;
  display: flex;
  justify-content: center;
  align-items: center;
}

#loginBox, #chat {
  background: rgba(0,0,0,0.5);
  padding: 20px;
  border-radius: 10px;
  width: 320px;
}

input, button {
  width: 100%;
  padding: 10px;
  margin-top: 10px;
  border: none;
  border-radius: 5px;
}

button {
  background: #00c6ff;
  color: black;
  font-weight: bold;
}

#messages {
  height: 220px;
  overflow-y: auto;
  background: white;
  color: black;
  padding: 10px;
  margin-top: 10px;
  border-radius: 5px;
}

#typing {
  font-size: 12px;
  color: #ccc;
  margin-top: 5px;
  height: 15px;
}

.msg { margin: 5px 0; padding: 5px 10px; border-radius: 10px; }
.me { background: #00c6ff; text-align: right; }
.other { background: #ddd; text-align: left; }
</style>
</head>
<body>

<div id="loginBox">
  <h2>Login</h2>
  <input id="user" placeholder="Usuario">
  <input id="pass" type="password" placeholder="Contraseña">
  <button id="btnLogin">Entrar</button>
</div>

<div id="chat" style="display:none">
  <h2>Chat</h2>
  <div id="messages"></div>
  <div id="typing"></div>
  <input id="text" placeholder="Mensaje">
  <button id="btnSend">Enviar</button>
</div>

<script>
var firebaseConfig = {
  apiKey: "AIzaSyCOF1P28mEDMlsQbvDYWkUTEF0EzQpi8t0",
  authDomain: "chat-seguro-de-sin-nombre.firebaseapp.com",
  databaseURL: "https://chat-seguro-de-sin-nombre-default-rtdb.firebaseio.com",
  projectId: "chat-seguro-de-sin-nombre",
  storageBucket: "chat-seguro-de-sin-nombre.appspot.com",
  messagingSenderId: "325857020249",
  appId: "1:325857020249:web:895ca856886fc1aab3e448"
};

firebase.initializeApp(firebaseConfig);
var db = firebase.database();

var users = {
  brandon: "sin nombre",
  yass: "sin nombre"
};

var currentUser = "";

document.getElementById("btnLogin").onclick = function(){
  var u = user.value.toLowerCase();
  var p = pass.value;

  if(users[u] && users[u] === p){
    currentUser = u;
    loginBox.style.display = "none";
    chat.style.display = "block";
    loadMessages();
    listenTyping();
  } else {
    alert("Usuario o contraseña incorrectos");
  }
};

document.getElementById("btnSend").onclick = send;

document.getElementById("text").addEventListener("keydown", function(e){
  if(e.key === "Enter") send();
  setTyping(true);
});

document.getElementById("text").addEventListener("keyup", function(){
  clearTimeout(window.typingTimer);
  window.typingTimer = setTimeout(function(){
    setTyping(false);
  }, 1000);
});

function send(){
  var text = document.getElementById("text").value;
  if(text.trim() !== ""){
    db.ref("messages").push({
      user: currentUser,
      text: text
    });
    document.getElementById("text").value = "";
    setTyping(false);
  }
}

function loadMessages(){
  db.ref("messages").on("child_added", function(snapshot){
    var data = snapshot.val();
    var div = document.createElement("div");
    div.className = "msg " + (data.user === currentUser ? "me" : "other");
    div.innerText = data.user + ": " + data.text;
    messages.appendChild(div);
    messages.scrollTop = messages.scrollHeight;
  });
}

// --- TYPING ---

function setTyping(state){
  db.ref("typing/" + currentUser).set(state);
}

function listenTyping(){
  db.ref("typing").on("value", function(snapshot){
    var data = snapshot.val();
    var typingText = "";

    for(var user in data){
      if(data[user] && user !== currentUser){
        typingText = user + " está escribiendo...";
      }
    }

    document.getElementById("typing").innerText = typingText;
  });
}
</script>
</body>
</html>
